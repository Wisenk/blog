<div class="container my-5" style="max-width: 900px;">

  <div class="card shadow-sm mb-4">
    <% if @post_blog.image.attached? %>
      <%= image_tag @post_blog.image, class: "card-img-top", style: "object-fit: cover; max-height: 400px;" %>
    <% end %>

    <div class="card-body">
      <h1 class="card-title mb-3"><%= @post_blog.title %></h1>
      <p class="card-text"><%= @post_blog.body %></p>

      <p class="text-muted mt-4 mb-0">
        Posted by <%= @post_blog.user.name if @post_blog.respond_to?(:user) %>
        on <%= @post_blog.created_at.strftime("%B %d, %Y") %>
      </p>

      <div class="mt-4">
        <%= link_to "Back to Posts", post_blogs_path, class: "btn btn-outline-secondary" %>
        <% if @post_blog.user == current_user %>
          <%= link_to "Edit", edit_post_blog_path(@post_blog), class: "btn btn-primary" %>
          <%= link_to "Delete", @post_blog, method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger" %>
        <% end %>

        !!--- Favorite Button --!
        <div class="d-inline-block">
          <% if @post_blog.favorited_by?(current_user) %>
            <%= link_to post_blog_favorite_path(@post_blog),
                        method: :delete,
                        remote: true,
                        class: "btn btn-warning btn-sm rounded-pill favorite-btn" do %>
              <span>♥</span> <span class="favorite-count"><%= @post_blog.favorites.count %></span>
            <% end %>
          <% else %>
            <%= link_to post_blog_favorite_path(@post_blog),
                        method: :post,
                        remote: true,
                        class: "btn btn-outline-warning btn-sm rounded-pill favorite-btn" do %>
              <span>♡</span> <span class="favorite-count"><%= @post_blog.favorites.count %></span>
            <% end %>
          <% end %>
        </div>

      </div>
    </div>
  </div>

 
  <div class="card shadow-sm">
    <div class="card-body">

      <h4 class="mb-4">Comments (<%= @post_blog.post_comments.count %>)</h4>

      <% if @post_blog.post_comments.any? %>
        <div class="list-group mb-4">
          <% @post_blog.post_comments.each do |post_comment| %>
            <div class="list-group-item list-group-item-action">
              <div class="media">
                <%= image_tag post_comment.user.get_profile_image, class: "rounded-circle mr-3", width: 50, height: 50 if post_comment.user %>

                <div class="media-body">
                  <div class="d-flex justify-content-between align-items-start">
                    <h5 class="mt-2 mb-1"><%= post_comment.user.name %></h5>
                    <small class="text-muted"><%= time_ago_in_words(post_comment.created_at) %> ago</small>
                  </div>

                  <p class="mt-2 mb-1"><%= post_comment.comment %></p>

                  <% if post_comment.user == current_user %>
                    <%= link_to "Delete", post_blog_post_comment_path(@post_blog, post_comment), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-sm btn-danger mt-2" %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-muted">No comments yet. Be the first to leave one!</p>
      <% end %>

 
      <h5 class="mt-4">Add a Comment</h5>
      <%= form_with model: [@post_blog, @post_comment], local: true do |f| %>
        <div class="form-group">
          <%= f.text_area :comment, class: "form-control", placeholder: "Write your comment here...", rows: 3, required: true %>
        </div>
        <%= f.submit "Post Comment", class: "btn btn-primary mt-2" %>
      <% end %>

    </div>
  </div>

</div>
